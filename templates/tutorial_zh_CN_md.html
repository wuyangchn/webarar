{% load static %}
<h3 id="webarar-">WebArAr 使用教程</h3>
<p><em>本文档更新于 <strong>2024年2月25日</strong></em></p>
<p><a href="/doc/tutorial">English</a></p>
<h3 id="-">目录</h3>
<ol>
<li><a href="#基本流程">基本流程</a></li>
<li><a href="#导入原始文件">导入原始文件</a></li>
<li><a href="#arr文件">arr文件</a></li>
<li><a href="#创建空白对象">创建空白对象</a></li>
<li><a href="#设置原始文件过滤器">设置原始文件过滤器</a></li>
<li><a href="#计算本底">计算本底</a></li>
<li><a href="#图表内容">图表内容</a></li>
<li><a href="#参数设置">参数设置</a></li>
<li><a href="#重新计算">重新计算</a></li>
<li><a href="#等时线选点">等时线选点</a></li>
<li><a href="#修改图件样式">修改图件样式</a></li>
<li><a href="#用等时线初始值扣空气氩">用等时线初始值扣空气氩</a></li>
<li><a href="#年龄分布图">年龄分布图</a></li>
<li><a href="#保存及导出">保存及导出</a></li>
</ol>
<h3 id="基本流程">基本流程</h3>
<ol>
<li><p><strong>导入数据</strong></p>
</li>
<li><p>支持读取质谱仪输出的原始文件：参阅<a href="#导入原始文件">导入原始文件</a>。</p>
</li>
<li><p>打开 arr 文件：arr 文件是WebArAr保存文件时的格式。参见<a href="#arr文件">arr文件</a>。</p>
</li>
<li><p>打开 ArArCALC 软件相关的 age 文件或其导出的 xls 文件。</p>
</li>
<li><p>创建空白对象：参阅<a href="#创建空白对象">创建空白对象</a>。</p>
</li>
<li><p><strong>查看、修改、计算</strong></p>
<p> 成功创建并打开样本对象后，将进入对象显示页面。左侧导航栏列出该对象拥有的表格和图形。</p>
<p> <img src="{% static 'readme/image-15.png' %}" alt="alt text"></p>
<p> 已打开的任何文件都将不再与用户的本地文件有关联，Sample 对象以数据流的形式在服务器端和用户端之间传递，不会自动形成文件，因此，除非用户下载 arr 文件，否则关闭窗口时将丢失所有操作。</p>
<p> 在对象显示页面可以进行的操作包括：</p>
</li>
<li><p>修改样品信息：</p>
<p>  采样地点、实验室、研究人员等信息可在 Information 修改，这些与计算无关。</p>
</li>
<li><p>编辑修改表格内容：</p>
<p>  所有的表格都是可编辑的，编辑后需要点击下方 Save changes 以保存修改。<a href="#图表内容">图表内容</a> 介绍了各个图表中的详细内容。</p>
</li>
<li><p>编辑参数：</p>
<p>  <em>注意：修改参数后不会自动调用计算，需要用户根据需要触发重新计算。参见 <a href="#重新计算">重新计算</a>。</em></p>
<ul>
<li><p>Total Param 包括了所有参数，编辑该表格并保存可以设置新的参数。</p>
</li>
<li><p>通过下方的 Irra Params、Calc Params 和 Smp Params 为所有阶段选择预先设定好的参数集，或手动输入参数。参见 <a href="#参数设置">参数设置</a></p>
</li>
</ul>
</li>
<li><p>与图形的通用交互</p>
<p>  所有的图形都由Echarts渲染，因此具备Echarts的特征和属性。为一些常用的属性添加了设置选项，参见<a href="#修改图件样式">修改图件样式</a>。</p>
</li>
<li><p>等时线中选择散点以拟合等时线</p>
<p>  参见 <a href="#等时线选点">等时线选点</a>。</p>
<p>  WebArAr提供了五个等时线，包括正反等时线和三个与氯相关的等时线。所有等时线和年龄谱图将使用相同的阶段选择组合，支持两种选择组合，即 Set1 和 Set2。</p>
</li>
</ol>
<h3 id="导入原始文件">导入原始文件</h3>
<ul>
<li><p>原始文件通常需要至少包括以下信息：每个 <strong>cycle</strong> 的零时刻时间，测量时间，信号量。</p>
</li>
<li><p>根据特定的过滤器读取文件内容，<a href="#设置原始文件过滤器">设置原始文件过滤器</a> 提供了设置过滤器的说明和示例。</p>
<ol>
<li><p>Mass Spec Raw Files </p>
<p> <img src="{% static 'readme/image-24.png' %}" alt="alt text"></p>
</li>
<li><p>可以一起打开多个原始文件作为一个样品文件，为每个文件选择过滤器 </p>
<p> <img src="{% static 'readme/image-22.png' %}" alt="alt text"></p>
</li>
</ol>
</li>
<li><p>外推零时刻值。</p>
<p>  可单击取消选择某些离群点，可勾选是否对这当前 <strong>阶段</strong> 的所有同位素都取消这一散点，可选择要采纳的拟合方式，可勾选是否将这个拟合方式对所有同位素应用，可将当前 <strong>阶段</strong> 设置为 本底，可导出指定阶段。</p>
<p>  <img src="{% static 'readme/image-25.png' %}" alt="alt text"></p>
</li>
<li><p>为每个样品阶段指定本底。</p>
<p>  下图的示例中，1-7-13 三个阶段被指定为本底阶段，可在默认下拉框中选择不同的扣本底策略，也可在各个本底阶段下拉框中灵活选择本底，可在右侧界面对本底进行计算，如 拟合计算插值，详见 <a href="#计算本底">计算本底</a>。</p>
<p>  <img src="{% static 'readme/image-26.png' %}" alt="alt text"></p>
<p>  默认的本底策略：</p>
<ol>
<li><strong>前置本底</strong>：每个本底被用于矫正在其之后进行的样品阶段，直到下一个本底出现，如果第一个阶段不是本底，则第一个本底也将被用于扣除其之前的几个样品阶段；</li>
<li><strong>后置本底</strong>：每个本底将用于矫正其之前进行的样品阶段，如果最后一个阶段不是本底，最后一个本底也将被用于扣除最后几个样品阶段；</li>
<li><strong>邻近本底</strong>：每个本底将被用于矫正距离最近的几个样品阶段。</li>
<li><strong>本底插值</strong>：以给定的本底信号值和测试时间拟合，每个样品阶段将根据测量时间计算本底值。需要先进性插值计算。</li>
</ol>
</li>
</ul>
<h3 id="arr文件">arr文件</h3>
<ul>
<li>arr 文件是以二进制保存的JSON序列化之后的Sample对象。</li>
</ul>
<h3 id="创建空白对象">创建空白对象</h3>
<ul>
<li><p>创建空白对象将支持由用户手动输入数据。</p>
</li>
<li><p>通常当只需要利用 WebArAr 的部分功能时，创建空白对象比较方便。</p>
</li>
</ul>
<h3 id="设置原始文件过滤器">设置原始文件过滤器</h3>
<ol>
<li><p>从 <em>Run</em> 界面编辑 原始文件过滤器。</p>
<p> <img src="{% static 'readme/image-17.png' %}" alt="alt text"></p>
</li>
<li><p>编辑已存在的过滤器（需要验证Pin），或创建一个新的过滤器。</p>
<p> <img src="{% static 'readme/image-3.png' %}" alt="alt text"></p>
</li>
<li><p>过滤器支持文本格式的文件和Excel多表格文件（xls）。对于 xls 文件，表格序号、行数、列数三位整数用于定位数据；对于文本文件，需要行数和列数两位整数。</p>
</li>
<li><p>示例1：AHD 文件。</p>
<p> 文件具有如下结构，TAB制表符分隔。下载该 AHD 文件 <a href="{% static 'readme/AHD.ahd' %}">AHD</a> 查看。</p>
<pre><code> Sample    sample_name
 Experiment    experiment_name
 Project
 Irradiation
 Standard
 Instrument    Argus    <span class="hljs-number">1</span>E-<span class="hljs-number">13</span>
 Time Stamp    <span class="hljs-number">21/06/2023</span>    <span class="hljs-number">0</span>:<span class="hljs-number">08</span>:<span class="hljs-number">53</span>
 Analyst
 Temperature    <span class="hljs-number">0</span>    Laser
 J-Value
 Fractionation
 Volume Correction    <span class="hljs-number">1</span>
 Counters    <span class="hljs-number">1</span>    <span class="hljs-number">15</span>    <span class="hljs-number">1</span>    <span class="hljs-number">0</span>

 Time    Intensity    <span class="hljs-number">37</span>    <span class="hljs-number">38</span>    <span class="hljs-number">39</span>    <span class="hljs-number">40</span>        Cycle #    Peakreading #
 <span class="hljs-number">96.124784</span>    <span class="hljs-number">0</span>.<span class="hljs-number">039713085</span>
 <span class="hljs-number">139.839784</span>    <span class="hljs-number">0</span>.<span class="hljs-number">017819889</span>
 <span class="hljs-number">96.124784</span>    <span class="hljs-number">0</span>.<span class="hljs-number">095037932</span>
 <span class="hljs-number">96.124784</span>    <span class="hljs-number">8.217368387</span>
 <span class="hljs-number">96.124784</span>    <span class="hljs-number">52.50271246</span>
 <span class="hljs-number">183.630784</span>    <span class="hljs-number">0</span>.<span class="hljs-number">039292885</span>
 <span class="hljs-number">227.343784</span>    <span class="hljs-number">0.01599587</span>
 <span class="hljs-number">183.630784</span>    <span class="hljs-number">0.088180873</span>
 <span class="hljs-number">183.630784</span>    <span class="hljs-number">7</span>.<span class="hljs-number">980598974</span>
 <span class="hljs-number">183.630784</span>    <span class="hljs-number">53.55335785</span>
</code></pre><p> 从文件可以确定各个参数及索引，头部信息 15 行，样品名 (0, 1, 2)，实验名 (0, 2, 2)，零时刻日期 (0, 7, 2)，零时刻时间 (0, 7, 3)，同位素值呈列排列，五个一组，因此36Ar为 (1, 2)，37Ar (2, 2)，38Ar (3, 2)，39Ar (4, 2)，40Ar (5, 2)，对应依次为 (1, 1)，37Ar (2, 1)，38Ar (3, 1)，39Ar (4, 1)，40Ar (5, 1)。注意勾选日期和时间均为单列字符串。</p>
<p> <img src="{% static 'readme/image-16.png' %}" alt="alt text"></p>
</li>
<li><p>示例2：NGX 导出的 xls 文件。</p>
<p> 文件部分内容如截图所示，详细可下载 <a href="{% static 'readme/NGX_Exported_XLS.xls' %}">NGX_Exported_XLS</a> 查看。</p>
<p> <img src="{% static 'readme/image-18.png' %}" alt="alt text"></p>
<p> <img src="{% static 'readme/image-19.png' %}" alt="alt text"></p>
<p> 对于这个文件，过滤器设置如下：</p>
<p> <img src="{% static 'readme/image-20.png' %}" alt="alt text"></p>
</li>
</ol>
<h3 id="计算本底">计算本底</h3>
<ol>
<li><p>单击下方的本底阶段名，将本底名添加到 Input 输入框，再次单击删除该本底。</p>
<p> <img src="{% static 'readme/image-27.png' %}" alt="alt text"></p>
</li>
<li><p>选择求平均 或 拟合插值。</p>
<p> 如下图示例，三个本底阶段拟合约束了中间十个样品阶段的本底值。</p>
<p> <img src="{% static 'readme/image-28.png' %}" alt="alt text"></p>
<p> 计算平均值或插值后，新的本底阶段将出现在 Output 文本框中，单击 Add 按钮 将其添加到本底中，之后即可在左侧 本底阶段 下拉框中选择该本底。</p>
<p> <img src="{% static 'readme/image-29.png' %}" alt="alt text"></p>
</li>
</ol>
<h3 id="图表内容">图表内容</h3>
<p><strong>表格</strong></p>
<ol>
<li>Information: 样品信息，如编号、矿物材料、实验室等。</li>
<li>Unknown：各样品阶段的同位素值。误差均为一倍 σ 绝对误差。</li>
<li>Blank：各样品阶段扣本底所用的同位素值。</li>
<li>Corrected：各样品阶段经过必须的校正之后的同位素值，包括本底校正、质量歧视矫正校正和衰变校正。</li>
<li>Degas Pattern：各同位素区分来源之后的值。</li>
<li>Publish：大多数情况下用于文章中发表Ar-Ar数据，包括阶段名、阶段条件、36Ara、37ArCa、38ArCl、39ArK、40Arr、表观年龄、年龄误差、各阶段内40Arr占比、各阶段39ArK释放占总量的比例、Ca/K值。</li>
<li>Age Spectra：40Arr/39ArK 和 表观年龄。</li>
<li>Isochrons：等时线数据，包括正反等时线、三个Cl相关图、三位图数据。</li>
<li>Total Params：所有参数。</li>
</ol>
<p><strong>图件</strong></p>
<ol>
<li>Age Spectra：年龄谱图。</li>
<li>Nor. Isochron：正等时线图。</li>
<li>Inv. Isochron：反等时线图。</li>
<li>K-Cl-Ar 1：二维Cl相关图 1，三张图的横纵坐标不同。</li>
<li>K-Cl-Ar 2：二维Cl相关图 2。</li>
<li>K-Cl-Ar 3：二维Cl相关图 3。</li>
<li>3D Correlation：三维校正图。</li>
<li>Degas Pattern：显示各个阶段释放的不同同位素比例。</li>
<li>Ages Distribution：显示表观年龄的分布，包括柱状图和KDE曲线。</li>
</ol>
<h3 id="参数设置">参数设置</h3>
<ul>
<li><p>参数设置分了三个类别：辐照参数（Irradiation Params），计算常数（Calculation Params），特征参数（Sample Params）。</p>
</li>
<li><p>在 <em>Run</em> 界面新增或编辑参数组，之后应用这些参数。</p>
<p>  <img src="{% static 'readme/image-32.png' %}" alt="alt text"></p>
</li>
<li><p>也可以在 Total Params 表中任意修改参数，这样可以为每个阶段设置不同的参数。</p>
</li>
<li><p>辐照参数</p>
<p>  <img src="{% static 'readme/image-30.png' %}" alt="alt text"></p>
</li>
<li><p>计算常数</p>
<p>  <img src="{% static 'readme/image-33.png' %}" alt="alt text"></p>
</li>
<li><p>特征参数</p>
<p>  <img src="{% static 'readme/image-34.png' %}" alt="alt text"></p>
</li>
</ul>
<h3 id="重新计算">重新计算</h3>
<ul>
<li><p>设置新的参数后并不会自动进行计算。</p>
</li>
<li><p>可勾选的选项如图所示：</p>
<ul>
<li>Reset Arr Attributes: 检查Arr结构，可以修正由于程序更新而缺失部分属性的旧文件。</li>
<li>Recalculate Correction 和 Degas 用于重新进行校正和Degas，需要勾选特定过程及其之后的计算。例如：修改了本底数据，则需要勾选从本底校正到年龄计算的所有选项，否则新的参数将不会真正作用到最终结果；如果修改了 J 值，则只需要勾选重新计算表观年龄，前面的阶段并不会受 J 值影响，同时还应该重新计算 等时线数据，因此还应该勾选 Reset Plot Data。</li>
<li><p>Reset Plot Style 用于重置图件样式。</p>
<p><img src="{% static 'readme/image-35.png' %}" alt="alt text"></p>
</li>
</ul>
</li>
</ul>
<h3 id="等时线选点">等时线选点</h3>
<ul>
<li><p>等时线支持两组选点（Set1 和 Set2），同时将在年龄谱图中绘制相应的年龄坪（年龄坪根据设置用指定的初始值扣除空气氩）。右侧显示两组选点的正反等时线和坪年龄。</p>
<p>  <img src="{% static 'readme/image-36.png' %}" alt="alt text"></p>
</li>
<li><p>单击散点将可以选择或取消选择阶段数据点。每次点击都会自动重新计算回归和年龄，响应速度与网络速度和阶段数有关。</p>
</li>
<li><p>为了提高相应速度为了方便操作，可以在按住 Ctrl 键后，连续点击多个数据点，这时不会自动重新计算，之后需要触发重新计算，或松开 Ctrl 的情况下再点击一个散点。</p>
</li>
</ul>
<h3 id="修改图件样式">修改图件样式</h3>
<ul>
<li><p>点击底部的 Style 按钮，可以设置当前显示的图件的属性信息，如坐标范围、线宽、颜色、字号等。</p>
</li>
<li><p>打开 Style 窗体后，点击图件元素，如线、点或文字，可以设置相应元素的属性。</p>
<p>  如打开 Style 后点击散点，打开散点属性设置，见下图。</p>
<p>  <img src="{% static 'readme/image-37.png' %}" alt="alt text"></p>
<p>  设置点大小为20：</p>
<p>  <img src="{% static 'readme/image-38.png' %}" alt="alt text"></p>
</li>
</ul>
<h3 id="用等时线初始值扣空气氩">用等时线初始值扣空气氩</h3>
<ul>
<li><p>在 特征参数（Sample Parameter）中为 Set1 和 Set2 设置初始值。</p>
</li>
<li><p>使用反等时线初始值扣除空气氩：</p>
<p>  <img src="{% static 'readme/image-40.png' %}" alt="alt text"></p>
<p>  <img src="{% static 'readme/image-39.png' %}" alt="alt text"></p>
</li>
<li><p>使用其他值扣除空气氩，本实例中与黑线参数相同，两者重合：</p>
<p>  <img src="{% static 'readme/image-42.png' %}" alt="alt text"></p>
<p>  <img src="{% static 'readme/image-41.png' %}" alt="alt text"></p>
</li>
</ul>
<h3 id="年龄分布图">年龄分布图</h3>
<ul>
<li><p>年龄分布图常用于单颗粒Ar-Ar年龄分析。数据来自 Age Spectra 表中的表观年龄。包括 KDE 曲线，柱状图，及年龄方块。</p>
<p>  <img src="{% static 'readme/image-43.png' %}" alt="alt text"></p>
</li>
<li><p>打开 Style 后，点击 红色KDE曲线 可以设置属性和KDE参数：
  常用正态概率密度函数，Scott和Sliverman两种自动计算带宽宽度方法，或选择none手动输入宽度。</p>
<p>  <img src="{% static 'readme/image-44.png' %}" alt="alt text"></p>
</li>
</ul>
<h3 id="保存及导出">保存及导出</h3>
<ul>
<li><p>点击 Export 打开导出对话框。</p>
<p>  <img src="{% static 'readme/image-45.png' %}" alt="alt text"></p>
</li>
<li><p>下载 arr 文件，单击 sample_name.arr 或右键另存。</p>
</li>
<li><p>选择其他格式导出:</p>
<ol>
<li>Excel：包含所有数据和图表（除三维图）；</li>
<li>PDF：导出二维的图件到PDF，可由Illustrator和CorelDRAW打开编辑。</li>
<li>SVG：导出二维的图件到SVG。</li>
</ol>
</li>
</ul>
